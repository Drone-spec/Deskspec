/*! For license information please see app.js.LICENSE.txt */
(()=>{"use strict";var e,t={951:(e,t,s)=>{var n=s(294),r=s(935),o=s(727),a=s(550),i=s(697),c=s.n(i);class l extends n.Component{constructor(e){super(e),this.createRefs()}componentDidMount(){this.loadAppIframe()}createRefs(){this.iframeRef=n.createRef()}loadAppIframe(){const e=new URL(`${this.props.browserExtensionUrl}webAccessibleResources/passbolt-iframe-app.html`);e.searchParams.append("passbolt","passbolt-iframe-app");const t=this.getPagePathname();t&&"/"!==t&&e.searchParams.append("pathname",t),this.iframeRef.current.contentWindow.location=e.toString()}getPagePathname(){return this.validatePagePathname()?this.props.location.pathname:null}validatePagePathname(){return/^[A-Za-z0-9\-\/]*$/.test(this.props.location.pathname)}render(){return n.createElement("iframe",{id:"passbolt-iframe-app",ref:this.iframeRef,className:"full-screen",allow:`clipboard-write ${this.props.browserExtensionUrl}webAccessibleResources/passbolt-iframe-app.html`})}}l.propTypes={browserExtensionUrl:c().string,location:c().object};const p=(0,a.EN)(l);class d extends n.Component{constructor(e){super(e),this.createRefs()}componentDidMount(){this.loadIframe()}createRefs(){this.iframeRef=n.createRef()}loadIframe(){const e=`${this.props.browserExtensionUrl}webAccessibleResources/passbolt-iframe-file.html?passbolt=passbolt-iframe-file`;this.iframeRef.current.contentWindow.location=e}render(){return n.createElement("iframe",{id:"passbolt-iframe-file",ref:this.iframeRef,className:"cachette"})}}d.propTypes={browserExtensionUrl:c().string};const u=d;class h{constructor(e){this.settings=e}get id(){return this.settings["user.id"]}get fullName(){return`${this.settings["user.firstname"]} ${this.settings["user.lastname"]}`}get username(){return this.settings["user.username"]}getTheme(){return this.settings["user.settings.theme"]}getTrustedDomain(){return this.settings["user.settings.trustedDomain"]}getSecurityToken(){return{code:this.settings["user.settings.securityToken.code"],backgroundColor:this.settings["user.settings.securityToken.color"],textColor:this.settings["user.settings.securityToken.textColor"]}}get locale(){return this.settings["user.settings.locale"]}}class m extends n.Component{componentDidMount(){window.addEventListener("passbolt.auth.is-authenticated",this.onIsAuthenticatedRequested.bind(this)),window.addEventListener("passbolt.plugin.auth.logout",this.onLogoutRequested.bind(this)),this.markPluginAsReady(),this.handleRouteChanges()}componentWillUnmount(){window.removeEventListener("passbolt.auth.is-authenticated",this.onIsAuthenticatedRequested.bind(this)),window.removeEventListener("passbolt.plugin.auth.logout",this.onLogoutRequested.bind(this)),clearInterval(this.handleRouteChangesInterval)}markPluginAsReady(){document.getElementsByTagName("html")[0].classList.add("passboltplugin-ready")}handleRouteChanges(){const e=this;this.handleRouteChangesInterval=setInterval((function(){const t=window.location.pathname;e.isApiPath(t)||(clearInterval(e.handleRouteChangesInterval),e.removeLegacyAppContainer(),window.location.reload())}),50)}isApiPath(e){return["/app/administration/mfa","/app/administration/users-directory","/app/administration/email-notification","/app/administration/internationalisation","/app/settings/mfa"].some((t=>e.endsWith(t)))}removeLegacyAppContainer(){const e=document.getElementById("container");e&&e.remove()}emitToPage(e,t){let s={event:e,data:t};"undefined"!=typeof cloneInto&&(s=cloneInto(s,document.defaultView));const n=new CustomEvent("addon-message",{bubbles:!0,cancelable:!0,detail:s});document.documentElement.dispatchEvent(n)}onIsAuthenticatedRequested(e){const t=e.detail[0];this.emitToPage(t,{status:"SUCCESS",body:!0})}onLogoutRequested(){this.props.port.request("passbolt.app-boostrap.navigate-to-logout")}render(){return n.createElement(n.Fragment,null)}}m.propTypes={port:c().object};const g=(0,a.EN)(m);class f extends n.Component{componentDidMount(){this.handleRouteChangeRequested()}handleRouteChangeRequested(){this.props.port.on("passbolt.app-bootstrap.change-route",(e=>{/^\/[A-Za-z0-9\-\/]*$/.test(e)&&this.props.history.replace(e)}))}render(){return n.createElement(n.Fragment,null)}}f.propTypes={history:c().object,port:c().any};const b=(0,a.EN)(f);class y extends n.Component{componentDidMount(){this.removeLegacyComponent()}removeLegacyComponent(){const e=document.getElementsByTagName("script");if(e&&e.length)for(;e.length>0;)e[0].remove();const t=document.getElementById("bus");t&&t.remove();const s=document.getElementsByTagName("footer");s&&s.length&&s[0].remove()}render(){return n.createElement(n.Fragment,null)}}const w=y;class v extends n.Component{constructor(e){super(e),this.state=this.getDefaultState(e)}getDefaultState(e){return{port:e.port,storage:e.storage,userSettings:null}}componentDidMount(){this.getUserSettings()}isPassboltApp(){const e=document.getRootNode().lastChild;return"HTML"===e?.tagName&&e.classList.contains("passbolt")}async getUserSettings(){const e=await this.props.storage.local.get(["_passbolt_data"]),t=new h(e._passbolt_data.config);this.setState({userSettings:t})}get isReady(){return null!==this.state.userSettings}get basename(){const e=this.state.userSettings.getTrustedDomain();return new URL(e).pathname}get isLegacyAppjs(){const e=document.getElementsByTagName("script");if(e)for(let t=0;t<e.length;t++)if(-1!==(e[t].src||"").indexOf("steal.production.js"))return!0;return!1}render(){return this.isPassboltApp()?n.createElement(n.Fragment,null,this.isReady&&n.createElement(o.VK,{basename:this.basename},n.createElement(b,{port:this.props.port}),n.createElement(a.rs,null,n.createElement(a.AW,{exact:!0,path:["/app/administration","/app/administration/mfa","/app/administration/users-directory","/app/administration/email-notification","/app/administration/smtp-settings","/app/settings/mfa"]},n.createElement(n.Fragment,null,this.isLegacyAppjs&&n.createElement(g,{port:this.props.port}))),n.createElement(a.AW,{exact:!0,path:["/app/account-recovery/requests/review/:accountRecoveryRequestId","/app/administration/subscription","/app/administration/account-recovery","/app/administration/sso","/app/folders/view/:filterByFolderId","/app/groups/view/:selectedGroupId","/app/groups/edit/:selectedGroupId","/app/passwords/view/:selectedResourceId","/app/passwords","/app/settings","/app/settings/keys","/app/settings/profile","/app/settings/passphrase","/app/settings/security-token","/app/settings/mobile","/app/settings/account-recovery","/app/settings/account-recovery/edit","/app/settings/theme","/app/users/view/:selectedUserId","/app/users","/app","/"]},this.isLegacyAppjs&&n.createElement(w,null),n.createElement(p,{browserExtensionUrl:this.props.browserExtensionUrl}),n.createElement(u,{browserExtensionUrl:this.props.browserExtensionUrl}))))):null}}v.propTypes={browserExtensionUrl:c().string,port:c().object,storage:c().object};const _=v;var E=s(150),R=s.n(E);R().scripting||(R().scripting=new class{executeScript(e){e.func?this._insertJsFunc(e):this._insertJsFiles(e)}insertCSS(e){let t=null;const s=e.files;for(let n=s.length-1;n>=0;--n){const r={file:s[n],runAt:"document_end",frameId:e.target?.frameId};t=this._createCssCallback(e.target.tabId,r,t)}t&&t()}_createJsCallback(e,t,s){return()=>chrome.tabs.executeScript(e,t,s)}_createCssCallback(e,t,s){return()=>chrome.tabs.insertCSS(e,t,s)}_insertJsFiles(e){let t=null;const s=e.files;for(let n=s.length-1;n>=0;--n){const r={file:s[n],runAt:"document_end",frameId:e.target?.frameId};t=this._createJsCallback(e.target.tabId,r,t)}t&&t()}_insertJsFunc(e){const t=JSON.stringify(e.args),s=`;${e.func.name}.apply(window, ${t});`,n={code:e.func.toString()+s,runAt:"document_end",frameId:e.target?.frameId};this._createJsCallback(e.target.tabId,n,null)()}});R().storage.session||(R().storage.session=new class{constructor(){this._storedData={}}async get(e){const t=typeof e;if("string"!==t&&"undefined"!==t)throw new Error(`Expected keys type of "string" but received an unsopprted type: ${t}`);return e?this._storedData[e]?{[e]:this._storedData[e]}:{}:this._storedData}async set(e){if("object"!=typeof e)throw new Error('Expected keys type of "object" but received an unsopprted type: '+typeof e);for(const t in e)this._storedData[t]=JSON.parse(JSON.stringify(e[t]))}async remove(e){delete this._storedData[e]}async clear(){this._storedData={}}});const C=R();var I=s(586),A=s(187);s(889);!async function(){const e=new class{constructor(e){if(this._listeners={},this.lock=new class{constructor(){this._locked=!1,this._ee=new A.EventEmitter}acquire(){return new Promise((e=>{if(!this._locked)return this._locked=!0,e();const t=()=>{if(!this._locked)return this._locked=!0,this._ee.removeListener("release",t),e()};this._ee.on("release",t)}))}release(){this._locked=!1,setImmediate((()=>this._ee.emit("release")))}},void 0===e)throw Error("A port name is required.");if("string"!=typeof e)throw Error("The port name should be a valid string.");this._name=e}connect(){let e;const t=new Promise((t=>{e=t}));return this._port=C.runtime.connect({name:this._name}),this._connected=!0,this.initListener(),this.once("passbolt.port.ready",e),t}initListener(){this._port.onDisconnect.addListener((()=>{console.warn(`port disconnected from addon code: ${this._name}`),this._connected=!1})),this._port.onMessage.addListener((e=>{this._onMessage(e)}))}_onMessage(e){const t=JSON.parse(e),s=t[0];if(Array.isArray(this._listeners[s])){const e=this._listeners[s];for(let n=0;n<e.length;n++){const r=e[n],o=Array.prototype.slice.call(t,1);r.callback.apply(this,o),r.once&&(this._listeners[s].splice(n,1),0===this._listeners[s].length&&delete this._listeners[s],n--)}}}_addListener(e,t,s){Array.isArray(this._listeners[e])||(this._listeners[e]=[]),this._listeners[e].push({name:e,callback:t,once:s})}on(e,t){this._addListener(e,t,!1)}once(e,t){this._addListener(e,t,!0)}async emit(...e){const t=JSON.stringify(e);await this.connectIfDisconnected(),this._port.postMessage(t)}request(e,...t){const s=(0,I.Z)(),n=[e,s].concat(t);return new Promise(((e,t)=>{this.once(s,((s,...n)=>{"SUCCESS"===s?e.apply(null,n):"ERROR"===s&&t.apply(null,n)})),this.emit.apply(this,n)}))}async connectIfDisconnected(){await this.lock.acquire(),this._connected||await this.connect(),this.lock.release()}}(self.portname);await e.connect();const t=R().storage,s=chrome.runtime.getURL("/"),o=document.createElement("div");document.body.appendChild(o),r.render(n.createElement(_,{port:e,storage:t,browserExtensionUrl:s}),o)}()}},s={};function n(e){var r=s[e];if(void 0!==r)return r.exports;var o=s[e]={exports:{}};return t[e].call(o.exports,o,o.exports,n),o.exports}n.m=t,e=[],n.O=(t,s,r,o)=>{if(!s){var a=1/0;for(p=0;p<e.length;p++){for(var[s,r,o]=e[p],i=!0,c=0;c<s.length;c++)(!1&o||a>=o)&&Object.keys(n.O).every((e=>n.O[e](s[c])))?s.splice(c--,1):(i=!1,o<a&&(a=o));if(i){e.splice(p--,1);var l=r();void 0!==l&&(t=l)}}return t}o=o||0;for(var p=e.length;p>0&&e[p-1][2]>o;p--)e[p]=e[p-1];e[p]=[s,r,o]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.j=143,(()=>{var e={143:0};n.O.j=t=>0===e[t];var t=(t,s)=>{var r,o,[a,i,c]=s,l=0;if(a.some((t=>0!==e[t]))){for(r in i)n.o(i,r)&&(n.m[r]=i[r]);if(c)var p=c(n)}for(t&&t(s);l<a.length;l++)o=a[l],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(p)},s=self.contentScriptChunkLoadingGlobal=self.contentScriptChunkLoadingGlobal||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var r=n.O(void 0,[216],(()=>n(951)));r=n.O(r)})();